<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reports - Dr. Labs</title>
<style>
    body { font-family: Arial; background: linear-gradient(to bottom right, lightblue, lightgreen); padding: 20px; }
    table { border-collapse: collapse; width: 100%; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #007BFF; color: white; }
    input, select, button { margin: 5px; padding: 5px; }
</style>
</head>
<body>
<h1>Reports</h1>
<div>
    <label>From: <input type="date" id="fromDate"></label>
    <label>To: <input type="date" id="toDate"></label>
    <input placeholder="City" id="city">
    <input placeholder="Technician" id="tech">
    <input placeholder="Agent" id="agent">
    <input placeholder="Status" id="status">
    <input placeholder="Phone" id="phone">
    <button onclick="getReports()">Filter</button>
    <button onclick="downloadCSV()">Download CSV</button>
</div>
<table id="reportTable">
    <thead>
        <tr>
            <th>Customer Number</th>
            <th>Customer Name</th>
            <th>Location</th>
            <th>Preferred Date</th>
            <th>Preferred Time</th>
            <th>Agent Name</th>
            <th>Technician</th>
            <th>Status</th>
            <th>Total Cost</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzCR-SayJVb0CUqY6UvGZlHdF0ZvfBejMR2qDndRI8dEVP1Lofq3BYnBkWpMl35pVyudg/exec"; // Replace with your Web App URL

function getReports() {
    const params = new URLSearchParams({
        action: "getReports",
        from: document.getElementById("fromDate").value,
        to: document.getElementById("toDate").value,
        city: document.getElementById("city").value,
        tech: document.getElementById("tech").value,
        agent: document.getElementById("agent").value,
        status: document.getElementById("status").value,
        phone: document.getElementById("phone").value
    });
    fetch(`${WEB_APP_URL}?${params}`)
    .then(r=>r.json())
    .then(data=>{
        const tbody = document.querySelector("#reportTable tbody");
        tbody.innerHTML = "";
        data.forEach(row=>{
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${row.customerNumber}</td><td>${row.customerName}</td><td>${row.location}</td><td>${row.prefDate}</td><td>${row.prefTime}</td><td>${row.agentName}</td><td>${row.technician}</td><td>${row.status}</td><td>${row.totalCost}</td>`;
            tbody.appendChild(tr);
        });
    });
}

function downloadCSV() {
    let csv = [];
    const rows = document.querySelectorAll("table tr");
    rows.forEach(row=>{
        const cols = row.querySelectorAll("th, td");
        const rowData = [];
        cols.forEach(col=>rowData.push(col.innerText));
        csv.push(rowData.join(","));
    });
    const blob = new Blob([csv.join("\n")], { type: "text/csv" });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.setAttribute("href", url);
    a.setAttribute("download", "report.csv");
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}
</script>
</body>
</html>
