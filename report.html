<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reports - Dr. Labs</title>
<style>
    body { font-family: Arial, sans-serif; background: linear-gradient(to bottom right, lightblue, lightgreen); padding: 20px; }
    h2 { text-align: center; }
    .filter { background: white; padding: 10px; margin-bottom: 15px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { padding: 6px; border: 1px solid #ccc; text-align: center; }
    button { padding: 6px 10px; }
</style>
</head>
<body>

<h2>Booking Reports</h2>
<div class="filter">
    <input type="date" id="startDate">
    <input type="date" id="endDate">
    <input type="text" id="city" placeholder="City">
    <input type="text" id="technician" placeholder="Technician">
    <input type="text" id="agent" placeholder="Agent">
    <input type="text" id="status" placeholder="Status">
    <input type="text" id="phone" placeholder="Phone">
    <button onclick="loadReports()">Filter</button>
    <button onclick="downloadCSV()">Download CSV</button>
</div>

<div id="reportTable"></div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbychu9AqOmWGUPEbjiofDMDJZ4dukfQyhEVYZTfBEBl1uWoZI02mCPB9pQP6D9Kk2c3Dw/exec";

function loadReports() {
    const params = {
        startDate: document.getElementById("startDate").value,
        endDate: document.getElementById("endDate").value,
        city: document.getElementById("city").value,
        technician: document.getElementById("technician").value,
        agent: document.getElementById("agent").value,
        status: document.getElementById("status").value,
        phone: document.getElementById("phone").value
    };
    fetch(WEB_APP_URL + "?action=getReports&" + new URLSearchParams(params))
        .then(r => r.json())
        .then(data => {
            let html = "<table><tr><th>Phone</th><th>Name</th><th>Location</th><th>Date</th><th>Time</th><th>Agent</th><th>Technician</th><th>Status</th><th>Total</th></tr>";
            data.forEach(row => {
                html += `<tr><td>${row.phone}</td><td>${row.name}</td><td>${row.location}</td><td>${row.date}</td><td>${row.time}</td><td>${row.agent}</td><td>${row.technician}</td><td>${row.status}</td><td>${row.total}</td></tr>`;
            });
            html += "</table>";
            document.getElementById("reportTable").innerHTML = html;
        });
}

function downloadCSV() {
    let table = document.querySelector("#reportTable table");
    if (!table) return alert("No data");
    let csv = [];
    table.querySelectorAll("tr").forEach(row => {
        let cols = [...row.querySelectorAll("td, th")].map(col => `"${col.innerText}"`);
        csv.push(cols.join(","));
    });
    let blob = new Blob([csv.join("\n")], { type: "text/csv" });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "report.csv";
    a.click();
}
</script>

</body>
</html>
